<!doctype html>
<dom-module id="login-test">

 <html>
 <head>

   <meta charset="utf-8">
   <link rel="import" href="../components/deps.html">
   <script src="../bower_components/web-component-tester/browser.js"></script>
 </head>
 <body>
  <script>
    page({hashbang: true});
 </script>
   <main-app></main-app>
    <template id="app" is="dom-bind">
     <login-page params="{{params}}"></login-page>
   </template>
   <script>
 var app = document.querySelector("main-app");
 
 suite('<login-page>', function() {
   test('paper button', function() {
     var page = document.querySelector('login-page');
     expect(document.querySelector('paper-button')).to.be.ok;
   });
   test('invalid email', function() {
     var page = document.querySelector('login-page');
     var button = document.querySelector('paper-button');
     var input = document.getElementById('email');
     var input1 = document.getElementById('password');
     var error = Polymer.dom(input.root).querySelector('paper-input-error');
     input.value = "email";
     input1.value = "12345678";
     button.click();
     assert.ok(error);
   });
   test('valid input', function() {
     var page = document.querySelector('login-page');
     var button = document.querySelector('paper-button');
     var input = document.getElementById('email');
     var input1 = document.getElementById('password');
     input.value = "123@hotmail.com";
     input1.value = "12345678";
     button.click();
     assert.ok(input);
     assert.ok(input1);
   });
   test('login function', function(){
     var page = document.querySelector('login-page');
     var loginButton = document.getElementById('login-button');
     var input = document.getElementById('email');
     var input1 = document.getElementById('password');
     var userDetails = document.querySelector('#userDetails');
     input.value = "mr_jko@hotmail.com";
     input1.value = "12345678";
     loginButton.click();
     setTimeout(function(){
      assert.equal(document.querySelector('main-app').userDetails.name, "Jimmy Ko");
      assert.isNotNull(document.getElementById('logout-button'));

      setTimeout(function(){
        var logoutButton = document.getElementById('logout-button');
        logoutButton.click();
        console.log(document.querySelector('main-app').userDetails);
      assert.equal(document.querySelector('main-app').userDetails, null);
      }, 3000);
     }, 1000);     
   });
 });
   </script>
       <iron-ajax id="userDetails" auto
             url="/api/currentUser/"
             handle-as="json"
             last-response="{{userDetails}}"></iron-ajax>
 </body>
 </html>
 </dom-module>
